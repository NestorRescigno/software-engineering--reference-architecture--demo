# *********************************************************************
# *************                 IAG                       *************
# *************       by Software Engineering             *************
# *********************************************************************
# This action yaml represents the different steps to perform 
# for a deployment in environment 
# usage architecture reference workflow

# currently it is only possible to configure 
# two types of languages "java and angular"
# this example use java
#
name: CI
on:
    workflow_dispatch:
#  pull_request:
    # Sequence of patterns matched against refs/heads
#    branches: [ main, develop ]
env:
  PROJECT: "best-practice"
  LENGUAGE: "java"
jobs:
  deploy:
    runs-on: [ancillaries, build]
    steps:
        # checkout source code in runner 
        - name: Checkout source
          uses: actions/checkout@v2
        # checkout source workflow action base in runner   
        - name: Checkout actions
          uses: actions/checkout@v2
          with:
            repository: 'Iberia-Ent/software-engineering--reference-architecture--workflow'
            token: ${{ secrets.TOKEN_REP }}
            ref: 'main'
            path: '.github/cicd'
        # Configure step build process    
        - name: build
          uses: ./.github/cicd/github_actions/build
          with:
              project_name: ${{ env.PROJECT }}
              lenguage-code: ${{ env.PROJECT }}
              aws-access-key: ${{secrets.AWS_ACCESS_KEY}} 
              aws-secret-acesss-key: ${{secrets.AWS_SECRET_ACCESS_KEY}} 
              codeartifact-allow: true # active true repositorio codeartifact - required: true - default: false (nexus adopt)
              repository-user: ${{secrets.CODEARTIFACT_OWNER}}                # user registry artifact - if codeArtifact allow then user is owner aws id.
              ### Disable because is codeArtifact
              # repository-host:  ${{secrets.nexus_url}}                  
              # repository-token: ${{secrets.nexus_key}}
